title
On-line Active Reward Learning for Policy Optimisation in Spoken Dialogue Systems
abstract
The ability to compute an accurate reward function is essential for optimising a dialogue policy via reinforcement learning .
In real-world applications , using explicit user feedback as the reward signal is often unreliable and costly to collect .
This problem can be mitigated if the user 's intent is known in advance or data is available to pre-train a task success predictor off-line .
In practice neither of these apply for most real world applications .
Here we propose an on-line learning framework whereby the dialogue policy is jointly trained alongside the reward model via active learning with a Gaussian process model .
This Gaussian process operates on a continuous space dialogue representation generated in an unsupervised fashion using a recurrent neural network encoder-decoder .
The experimental results demonstrate that the proposed framework is able to significantly reduce data annotation costs and mitigate noisy user feedback in dialogue policy learning .
Introduction Spoken Dialogue Systems ( SDS ) allow humancomputer interaction using natural speech .
They can be broadly divided into two categories : chatoriented systems which aim to converse with users and provide reasonable contextually relevant responses ( Vinyals and Le , 2015 ; Serban et al. , 2015 ) , and task - oriented systems designed to assist users to achieve specific goals ( e.g. find hotels , movies or bus schedules ) ( Daubigney et al. , 2014 ; .
The latter are typically designed according to a structured ontology ( or a database schema ) , which defines the domain Figure 1 : An example of a task - oriented dialogue with a pre-defined task and the evaluation results .
that the system can talk about .
Teaching a system how to respond appropriately in a task - oriented SDS is non-trivial .
This dialogue management task is often formulated as a manually defined dialogue flow that directly determines the quality of interaction .
More recently , dialogue management has been formulated as a reinforcement learning ( RL ) problem which can be automatically optimised ( Levin and Pieraccini , 1997 ; Roy et al. , 2000 ; Williams and Young , 2007 ; .
In this framework , the system learns by a trial and error process governed by a potentially delayed learning objective defined by a reward function .
A typical approach to defining the reward function in a task - oriented dialogue system is to apply a small per-turn penalty to encourage short dialogues and to give a large positive reward at the end of each successful interaction .
Figure 1 is an example of a dialogue task which is typically set for users who are being paid to converse with the system .
When users are primed with a specific task to complete , dialogue success can be determined from subjective user ratings ( Subj ) , or an objective measure ( Obj ) based on whether or not the pre-specified task was completed ( Walker et al. , 1997 ; .
However , prior knowledge of the user 's goal is not normally available in real situations , making the objective reward estimation approach impractical .
Furthermore , objective ratings are inflexible and often fail as can be seen from Figure 1 , if the user does not strictly follow the task .
This results in a mismatch between the Obj and Subj ratings .
However , relying on subjective ratings alone is also problematic since crowd-sourced subjects frequently give inaccurate responses and real users are often unwilling to extend the interaction in order to give feedback , resulting in unstable learning ( Zhao et al. , 2011 ; Ga?i? et al. , 2011 ) .
In order to filter out incorrect user feedback , used only dialogues for which Obj = Subj .
Nonetheless , this is inefficient and not feasible anyway in most real-world tasks where the user 's goal is generally unknown and difficult to infer .
In light of the above , Su et al . ( 2015a ) proposed learning a neural network - based Obj estimator from off-line simulated dialogue data .
This removes the need for the Obj check during online policy learning and the resulting policy is as effective as one trained with dialogues using the Obj = Subj check .
However , a user simulator will only provide a rough approximation of real user statistics and developing a user simulator is a costly process ( Schatzmann et al. , 2006 ) .
To deal with the above issues , this paper describes an on-line active learning method in which users are asked to provide feedback on whether the dialogue was successful or not .
However , active learning is used to limit requests for feedback to only those cases where the feedback would be useful , and also a noise model is introduced to compensate for cases where the user feedback is inaccurate .
A Gaussian process classification ( GPC ) model is utilised to robustly model the uncertainty presented by the noisy user feedback .
Since GPC operates on a fixed - length observation space and dialogues are of variable - length , a recurrent neural network ( RNN ) - based embedding function is used to provide fixed - length dialogue representations .
In essence , the proposed method learns a dialogue policy and a reward estimator on - line from scratch , and is directly applicable to real-world applications .
The rest of the paper is organised as follows .
The next section gives an overview of related work .
The proposed framework is then described in ?3 .
This consists of the policy learning algorithm , the creation of the dialogue embedding function and the active reward model trained from real user ratings .
In ?4 , the proposed approach is evaluated in the context of an application providing restaurant information in Cambridge , UK .
We first give an in- depth analysis of the dialogue embedding space .
The results of the active reward model when it is trained together with a dialogue policy on -line with real users are then presented .
Finally , our conclusions are presented in ?5 .
Related Work Dialogue evaluation has been an active research area since late 90s .
Walker et al. ( 1997 ) proposed the PARADISE framework , where a linear function of task completion and various dialogue features such as dialogue duration were used to infer user satisfaction .
This measure was later used as a reward function for learning a dialogue policy ( Rieser and Lemon , 2011 ) .
However , as noted , task completion is rarely available when the system is interacting with real users and also concerns have been raised regarding the theoretical validity of the model ( Larsen , 2003 ) .
Several approaches have been adopted for learning a dialogue reward model given a corpus of annotated dialogues .
Yang et al. ( 2012 ) used collaborative filtering to infer user preferences .
The use of reward shaping has also been investigated in ( El Asri et al. , 2014 ; Su et al. , 2015 b ) to enrich the reward function in order to speed up dialogue policy learning .
Also , Ultes and Minker ( 2015 ) demonstrated that there is a strong correlation between expert 's user satisfaction ratings and dialogue success .
However , all these methods assume the availability of reliable dialogue annotations such as expert ratings , which in practice are hard to obtain .
One effective way to mitigate the effects of annotator error is to obtain multiple ratings for the same data and several methods have been developed to guide the annotation process with uncertainty models ( Dai et al. , 2013 ; .
Active learning is particularly useful for determining when an annotation is needed ( Settles , 2010 ; Zhang and Chaudhuri , 2015 ) .
It is often utilised using Bayesian optimisation approaches ( Brochu et al. , 2010 ) .
Based on this , Daniel et al . ( 2014 ) exploited a pool-based active learning method for a robotics application .
They queried the user for feedback on the most informative sample collected so far and showed the effectiveness of this method .
Rather than explicitly defining a reward function , inverse RL ( IRL ) aims to recover the underlying reward from demonstrations of good behaviour and then learn a policy which maximises the recovered reward ( Russell , 1998 ) .
IRL was first introduced to SDS in ( Paek and Pieraccini , 2008 ) , where the reward was inferred from human-human dialogues to mimic the behaviour observed in a corpus .
IRL has also been studied in a Wizard - of - Oz ( WoZ ) setting ( Boularias et al. , 2010 ; Rojas Barahona and Cerisara , 2014 ) , where typically a human expert served as the dialogue manager to select each system reply based on the speech understanding output at different noise levels .
However , this approach is costly and there is no reason to suppose that a human wizard is acting optimally , especially at high noise levels .
Since humans are better at giving relative judgements than absolute scores , another related line of research has focused on preference - based approaches to RL ( Cheng et al. , 2011 ) .
In ( Sugiyama et al. , 2012 ) , users were asked to provide rankings between pairs of dialogues .
However , this is also costly and does not scale well in real applications .
Proposed Framework
The proposed system framework is depicted in Figure 2 .
It is divided into three main parts : a dialogue policy , a dialogue embedding function , and an active reward model of user feedback .
When each dialogue ends , a set of turn - level features f t is extracted and fed into an embedding function ? to obtain a fixed - dimension dialogue representation d that serves as the input space of the reward model R .
This reward is modelled as a Gaussian process which for every input point provides an estimate of task success along with a measure of the estimate uncertainty .
Based on this uncertainty , R decides whether to query the user for feedback or not .
It then returns a reinforcement signal to update the dialogue policy ? , which is trained using the GP- SARSA algorithm ( Ga?i? and Young , 2014 ) . GP -SARSA also deploys Gaussian process estimation to provide an on-line sample - efficient reinforcement learning algorithm capable of bootstrapping estimates of sparse value functions from minimal numbers of samples ( dialogues ) .
The quality of each dialogue is defined by its cumulative reward , where each dialogue turn incurs a small negative reward ( - 1 ) and the final reward of either 0 or 20 depending on the estimate of task success are provided by the reward model .
Note that the key contribution here is to learn the noise robust reward model and the dialogue policy simultaneously on -line , using the user as a ' supervisor ' .
Active learning is not an essential component of the framework but highly desirable in practice to minimise the impact of the supervision burden on users .
The use of a pre-trained embedding function is a sub-component of the proposed approach and is trained off-line on corpus data rather than manually designed here .
Unsupervised Dialogue Embeddings
In order to model user feedback over dialogues of varying length , an embedding function is used to map each dialogue into a fixed - dimensional continuous -space .
The use of embedding functions has recently gained attention especially for word representations , and has boosted performance on several natural language processing tasks ( Mikolov et al. , 2013 ; Levy and Goldberg , 2014 ) .
Embedding has also been successfully applied to machine translation ( MT ) where it enables varying - length phrases to be mapped to fixed - length vectors using an RNN Encoder - Decoder ( Cho et al. , 2014 ) .
Similar to MT , dialogue embedding enables variable length sequences of utterances to be mapped into an appropriate fixed - length vector .
Although embedding is used here to create a fixed - dimension input space for the GPC - based task success classifier , it should be noted that it potentially facilitates a variety of other downstream tasks which depend on classification or clustering .
The model structure of the embedding function is described on the left of Figure 2 , where the episodic turn - level features f t are extracted from a dialogue and serve as the input features to the encoder .
In our proposed model , the encoder is a Bi-directional Long Short - Term Memory network ( BLSTM ) ( Hochreiter and Schmidhuber , 1997 ; Graves et al. , 2013 ) .
The LSTM is a Recurrent Neural Network ( RNN ) with gated recurrent units introduced to alleviate the vanishing gradient problem .
The BLSTM encoder takes into account the sequential information from both directions of the input data , computing the forward ? ? h T :1 while iterating over all input features f t , t = 1 , ... , T : ? ? h t = LST M ( f t , ? ? h t?1 ) ? ? h t = LST M ( f t , ? ? h t +1 ) where LST M denotes the activation function .
The dialogue representation d is then calculated as the average over all hidden sequences : d = 1 T T t=1 h t ( 1 ) where h t = [ ? ? h t ; ? ? h t ] is the concatenation of the two directional hidden sequences .
Given the dialogue representation d output by the encoder , the decoder is a forward LSTM that takes d as its input for each turn t to produce the sequence of features f 1:T .
The training objective of the encoder-decoder minimises the mean-square - error ( MSE ) between the prediction f 1:T and the output f 1:T ( which is also the input ) : M SE = 1 N N i=1 T t=1 ||f t ? f t || 2 ( 2 ) where N is the number of training dialogues and || ? || 2 denotes the l 2 - norm .
Since all the functions used in the encoder and decoder are differentiable , stochastic gradient decent ( SGD ) can be used to train the model .
The dialogue representations generated by this LSTM - based unsupervised embedding function are then used as the observations for the reward model described in the next section 3.2 .
Active Reward Learning A Gaussian process is a Bayesian non-parametric model that can be used for regression or classification ( Rasmussen and Williams , 2006 ) .
It is particularly appealing since it can learn from a small number of observations by exploiting the correlations defined by a kernel function and it provides a measure of uncertainty of its estimates .
In the context of spoken dialogue systems it has been successfully used for RL policy optimisation ( Ga?i? and Young , 2014 ; Casanueva et al. , 2015 ) and IRL reward function regression ( Kim et al. , 2014 ) .
Here we propose modelling dialogue success as a Gaussian process ( GP ) .
This involves estimating the probability p( y|d , D ) that the task was successful given the current dialogue representation d and the pool D containing previously classified dialogues .
We pose this as a classification problem where the rating is a binary observation y ? { ? 1 , 1 } that defines failure or success .
The observations y are considered to be drawn from a Bernoulli distribution with a success probability p(y = 1|d , D ) .
The probability is related to a latent function f ( d|D ) : R dim ( d ) ?
R that is mapped to a unit interval by a probit function p(y = 1 |d , D ) = ?( f ( d|D ) ) , where ? denotes the cumulative density function of the standard Gaus-sian distribution .
The latent function is given a GP prior : f ( d ) ? GP ( m ( d ) , k( d , d ) ) , where m( ? ) is the mean function and k( ? , ? ) the covariance function ( kernel ) .
Here the stationary squared exponential kernel k SE is used .
It is also combined with a white noise kernel k W N in order to account for the " noise " in users ' ratings : k( d , d ) = p 2 exp ( ? || d ? d || 2 2l 2 ) + ? 2 n ( 3 ) where the first term denotes k SE and the second term k W N .
The hyper-parameters p , l , ? n can be adequately optimised by maximising the marginal likelihood using a gradient - based method ( Chen et al. , 2015 ) . Since ?(? ) is not Gaussian , the resulting posterior probability p(y = 1|d , D ) is analytically intractable .
So instead an approximation method , expectation propagation ( EP ) , was used ( Nickisch and Rasmussen , 2008 ) .
Querying the user for feedback is costly and may impact negatively on the user experience .
This impact can be reduced by using active learning informed by the uncertainty estimate of the GP model ( Kapoor et al. , 2007 ) .
This ensures that user feedback is only sought when the model is uncertain about its current prediction .
For the current application , an on-line ( stream- based ) version of active learning is required .
An illustration of a 1 - dimensional example is shown in Figure 3
When deploying this reward model in the proposed framework , a GP with a zero-mean prior for f is initialised and D = {} .
After the dialogue policy ?
completes each episode with the user , the generated dialogue turns are transformed into the dialogue representation d = ?( f 1:T ) using the dialogue embedding function ?.
Given d , the predictive mean and variance of f ( d|D ) are determined , and the reward model decides whether or not it should seek user feedback based on the threshold ? on ?( f ( d|D ) ) .
If the model is uncertain , the
Experimental results
The target application is a live telephone - based spoken dialogue system providing restaurant information for the Cambridge ( UK ) area .
The domain consists of approximately 150 venues each having 6 slots ( attributes ) of which 3 can be used by the system to constrain the search ( food - type , area and price-range ) and the remaining 3 are informable properties ( phone- number , address and postcode ) available once a required database entity has been found .
The shared core components of the SDS common to all experiments comprise a HMM - based recogniser , a confusion network ( CNet ) semantic input decoder ( Henderson et al. , 2012 ) , the BUDS belief state tracker ( Thomson and Young , 2010 ) that factorises the dialogue state using a dynamic Bayesian network , and a template based natural language generator to map system semantic actions into natural language responses to the user .
All policies were trained using the GP - SARSA algorithm and the summary action space of the RL policy contains 20 actions .
The reward given to each dialogue was set to 20 ? 1 success ?
N , where N is the dialogue turn number and 1 is the indicator function for dialogue success , which is determined by different methods as described in the following section .
These rewards constitute the reinforcement signal used for policy learning .
Dialogue representations
The LSTM Encoder - Decoder model described in ?3.1 was used to generate an embedding d for each dialogue .
For each dialogue turn that contains a user 's utterance and a system 's response , a feature vector f of size 74 was extracted ( Vandyke et al. , 2015 ) .
This vector consists of the concatenation of the most likely user intention determined by the semantic decoder , the distribution over each concept of interest defined in the ontology , a onehot encoding of the system 's reply action , and the turn number normalised by the maximum number of turns ( here 30 ) .
This feature vector was used as the input and the target for the LSTM Encoder - Decoder model , where the training objective was to minimise the MSE of the reconstruction loss .
The model was implemented using the Theano library ( Bergstra et al. , 2010 ; Bastien et al. , 2012 ) .
A corpus consisting of 8565 , 1199 and 650 real user dialogues in the Cambridge restaurant domain was used for training , validation and testing respectively .
This corpus was collected via the Amazon Mechanical Turk ( AMT ) service , where paid subjects interacted with the dialogue system .
The sizes of ? ? h t and ? ? h t in the encoder and the hidden layer in the decoder were all 32 , resulting in dim ( h t ) = dim ( d ) = 64 .
SGD per dialogue was used during backpropagation to train each model .
In order to prevent over-fitting , early stopping was applied based on the held - out validation set .
In order to visualise the impact of the embeddings , the dialogue representations of all the 650 test dialogues were transformed by the embedding function in Figure 4 and reduced to two dimensions using t-SNE ( Van der Maaten and Hinton , 2008 ) .
For each dialogue sample , the shape indicates whether or not the dialogue was successful , and the colour indicates the length of the dialogue ( maximum 30 turns ) .
From the figure we can clearly see the colour gradient from the top left ( shorter dialogues ) to the bottom right ( longer dialogues ) for the positive Subj labels .
This shows that dialogue length was one of the prominent features in the dialogue representation d .
It can also be seen that the longer failed dialogues ( more than 15 turns ) are located close to each other , mostly at the bottom right .
On the other hand , there are other failed dialogues which are spread throughout the cluster .
We can also see that the successful dialogues were on average shorter than 10 turns , which is consistent with the claim that users do not engage in longer dialogues with well - trained task - oriented systems .
This visualisation shows the potential of the unsupervised dialogue embedding since the transformed dialogue representations appear to be correlated with dialogue success in the majority of cases .
For the purpose of GP reward modelling , this LSTM Encoder - Decoder embedding function appears therefore to be suitable for extracting an adequate fixed - dimension dialogue representation .
Dialogue Policy Learning Given the well - trained dialogue embedding function , the proposed GP reward model operates on this input space .
The system was implemented using the GPy library ( Hensman et al. , 2012 ) .
Given the predictive success probability of each newly seen dialogue , the threshold ? for the uncertainty region was initially set to 1 to encourage label querying and annealed to 0.85 for the first 50 collected dialogues and then set to 0.85 thereafter .
Initially , as each new dialogue was added to the training set , the hyper-parameters that defined the structure of the kernels mentioned in Eqn.
3 were optimised to minimise the negative log marginal likelihood using conjugate gradient as- cent ( Rasmussen and Williams , 2006 ) .
To prevent overfitting , after the first 40 dialogues , these hyper-parameters were only re-optimised after every batch of 20 dialogues .
To investigate the performance of the proposed on - line GP policy learning , three other contrasting systems were also tested .
Note that the handcrafted system is not compared since it does not scale to larger domains and is sensitive to speech recognition errors .
In each case , the only difference was the method used to compute the reward : ? the Obj=Subj system which uses prior knowledge of the task to only use training dialogues for which the user 's subjective assessment of success is consistent with the objective assessment of success as in . ? the Subj system which directly optimises the policy using only the user assessment of success whether accurate or not .
? the off-line RNN system that uses 1 K simulated data and the corresponding Obj labels to train an RNN success estimator as in ( Su et al. , 2015 a ) .
For the Subj system rating , in order to focus solely on the performance of the policy rather than other aspects of the system such as the fluency of the reply sentence , users were asked to rate dialogue success by answering the following question :
Did you find all the information you were looking for ?
All four of the above systems were trained with a total of 500 dialogues on - line by users recruited via the AMT service .
Figure 5 shows the online learning curve of the subjective success rating when during training .
For each system , the moving average was calculated using a window of 150 dialogues .
In each case , three distinct policies were trained and the results were averaged to reduce noise .
As can be seen , all four systems perform better than 80 % subjective success rate after approximately 500 training dialogues .
The Obj=Subj system is relatively poor compared to the others .
This might be because users often report success even though the objective evaluation indicates failure .
In such cases , the dialogue is discarded and not used for training .
As a consequence , the Obj=Subj system required approximately 700 dialogues in order to obtain 500 which were useful , whereas all other systems made use of every dialogue .
To investigate learning behaviour over longer spans , training for the on-line GP and the Subj systems was extended to 850 dialogues .
As can be seen , performance in both cases is broadly flat .
Similar to the conclusions drawn in ( Ga?i? et al. , 2011 ) , the Subj system suffers from unreliable user feedback .
Firstly , as in the Obj=Subj system , users forget the full requirements of the task and in particular , forget to ask for all required information .
Secondly , users give inconsistent feedback due to a lack of proper care and attention .
From Figure 5 it can be clearly seen that the online GP system consistently performed better than Subj system , presumably , because its noise model mitigates the effect of inconsistency in user feedback .
Of course , unlike crowd-sourced subjects , real users might provide more consistent feedback , but nevertheless , some inconsistency is inevitable and the noise model offers the needed robustness .
The advantage of the on- line GP system in reducing the number of times that the system requests user feedback ( i.e. the label cost ) can be seen in Figure 6 .
The black curve shows the number of active learning queries triggered in the online GP system averaged across the three policies .
This system required only 150 user feedback requests to train a robust reward model .
On the other hand , the Obj=Subj and Subj systems require user feedback for every training dialogue as shown by the dashed orange line .
Of course , the off-line RNN system required no user feedback at all when training the system online since it had the benefit of prior access to a user simulator .
Its performance during training after the first 300 dialogues was , however , inferior to the on-line GP system .
Dialogue Policy Evaluation
In order to compare performance , the averaged results obtained between 400 - 500 training dialogues are shown in the first section of Table 1 along with one standard error .
For the 400 - 500 interval , the Subj , off- line RNN and on - line GP systems achieved comparable results without statistical differences .
The results of continuing training on the Subj and on - line GP systems from 500 to 850 training dialogues are also shown .
As can be seen , the on- line GP system was significantly better presumably because it is more robust to erroneous user feedback compared to the Subj system .
Reward Model Evaluation
The above results verify the effectiveness of the proposed reward model for policy learning .
Here we investigate further the accuracy of the model in predicting the subjective success rate .
An evaluation of the on- line GP reward model between 1 and 850 training dialogues is presented in Table 2 .
Since three reward models were learnt each with 850 dialogues , there were a total of 2550 training dialogues .
Of these , the models queried the user for feedback a total of 454 times , leaving 2096 dialogues for which learning relied on the reward model 's prediction .
The results shown in the table are thus the average over 2096 dialogues .
As can be seen , there was a significant imbalance between success and fail labels since the policy was improving along with the training dialogues .
This lowered the recall on failed dialogue prediction as the model was biased to data with positive labels .
Nevertheless , its precision scores well .
On the other hand , the successful dialogues were accurately predicted by the proposed model .
Example Dialogues
The key benefits of the on- line GP reward model compared to other models are its robustness to noise and efficient use of user supervision .
Since the four systems compared above differ only in the design of reward model ( learning objective ) , their on - line behaviours were broadly similar .
Two example dialogues between users and the on-line GP system are listed in Table 3 to illustrate how the system operates under different noise conditions .
The user 's subjective rating and the rating determined by the on-line GP reward model are also shown .
The labels ' n - th ASR ' and ' nth SEM ' indicate the n-th most likely hypotheses from speech recogniser and semantic decoder respectively .
Table 3 : Example dialogues between on - line users and the proposed on - line GP system .
Conclusion
In this paper we have proposed an active reward learning model using Gaussian process classification and an unsupervised neural network - based dialogue embedding to enable truly on - line policy learning in spoken dialogue systems .
The system enables stable policy optimisation by robustly modelling the inherent noise in real user feedback and uses active learning to minimise the number of feedback requests to the user .
We found that the proposed model achieved efficient policy learning and better performance compared to other stateof - the - art methods in the Cambridge restaurant domain .
A key advantage of this Bayesian model is that its uncertainty estimate allows active learning and noise handling in a natural way .
The unsupervised dialogue embedding function required no labelled data to train whilst providing a compact and useful input to the reward predictor .
Overall , the techniques developed in this paper enable for the first time a viable approach to on - line learning in deployed real-world dialogue systems which does not need a large corpus of manually annotated data or the construction of a user simulator .
Consistent with all of our previous work , the reward function studied here is focused primarily on task success .
This may be too simplistic for many commercial applications and further work will be needed in conjunction with human interaction experts to identify and incorporate the extra dimensions of dialogue quality that will be needed to achieve the highest levels of user satisfaction .
Figure 2 : 2 Figure2 : Schematic of the system framework .
The three main system components dialogue policy , dialogue embedding creation , and reward modelling based on user feedback , are described in ?3 .
