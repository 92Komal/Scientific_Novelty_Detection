title
NRC Machine Translation System for WMT 2017
abstract
We describe the machine translation systems developed at the National Research Council of Canada ( NRC ) for the Russian - English and Chinese -English news translation tasks of the Second Conference on Machine Translation ( WMT 2017 ) .
We conducted several experiments to explore the best baseline settings for neural machine translation ( NMT ) .
In the Russian - English task , to our surprise , our bestperforming system is one that rescores phrase - based statistical machine translation outputs using NMT rescoring features .
On the other hand , in the Chinese - English task , which has far more parallel training data , NMT is able to outperform SMT significantly .
The NRC MT systems is the best constrained system in Russian - English ( out of nine participants ) and the fourth best constrained system in Chinese - English ( out of twenty participants ) in WMT 2017 human evaluation .
Introduction
We present NRC 's submission to the Russian - English and Chinese-English news translation task of WMT 2017 .
In contrast to last year , when we participated in the Russian - English task only , with our well - developed phrase - based statistical machine translation system ( Lo et al. , 2016 ; Larkin et al. , 2010 ; Foster et al. , 2009 ) , this year we built large-scale state - of - the - art neural machine translation ( NMT ) systems for these two language pairs to facilitate further understanding and discussion of NMT .
Russian - English and Chinese-English are both challenging language pairs for machine transla - * Work performed while at NRC .
tion .
Russian is a highly inflectional and free word order language .
The skewed Russian to English word type ratio introduces a data sparsity problem that cannot be solved by discarding word inflections , since they play an important role in disambiguating the meaning of sentences .
Chinese does not have clear word boundaries .
The number of Chinese word types created by automatic word segmentation software is high , while naive character segmentation would result in a skewed Chinese to English sentence length ratio .
These characteristics make it difficult for machine translation systems to learn the correct association between words in Chinese and English .
Since this was the first time we deployed NMT models in an evaluation , we first tried to replicate the results of previous work ( Sennrich et al. , 2016 a ) .
Our NMT systems are based on Nematus ( Sennrich et al. , 2017 ) .
We used automatic back -translation of a subselected monolingual News corpus as additional training data , and all the training data is segmented into subword units using BPE ( Sennrich et al. , 2016 c ) .
We also experimented with pervasive dropout as implemented in Nematus .
For Russian - English , our WMT16 PBMT system scored higher than all the NMT systems we built this year .
We therefore experimented with using the NMT systems as features for rescoring the 1000 - best output from our WMT16 PBMT system .
This strategy yielded almost 2 BLEU point improvement over the PBMT baseline .
For Chinese - English , we exploited different domain adaptation techniques to boost the system performance on in- domain news translation .
We also integrated various regularization methods to avoid the systems overfitting to the small development set .
The NRC Russian - English and Chinese-English news translation systems achieve competitive per-formance ( third place in both language pairs ) in the preliminary automatic evaluation of WMT 2017 .
In this paper , we discuss the lessons learned in building large-scale state - of - the - art NMT systems .
Russian - English news translation
We used all the Russian - English parallel corpora available for the constrained news translation task .
They include the CommonCrawl corpus , the NewsCommentary v12 corpus , the Yandex corpus and the Wikipedia headlines corpus .
In total , 2.6 million parallel Russian - English sentences are used to train the baseline system .
We use the news translation test set of WMT 15 as development set and that of WMT 16 as test set .
The Russian and English texts in the training / development / test corpora were kept in their original true case and tokenized , then the Russian and English texts were combined to train a BPE model with vocabulary size of 30k .
NMT baseline system Our NMT baseline system is developed using Nematus ( Sennrich et al. , 2017 ) .
The dimension of word embeddings is set to 512 and that of the hidden layers is set to 1024 .
We train the models with rmsprop ( Tieleman and Hinton , 2012 ) , reshuffling the training corpus between epochs .
We use minibatches of size 100 and validate the model every 8000 minibatches against BLEU on the WMT 15 news translation test set .
We perform early stopping on the baseline system .
We use AmuNMT C ++ decoder ( Junczys - Dowmunt et al. , 2016a ) with a beam size of 4 .
Synthetic training data
In statistical machine translation , large monolingual corpora in the output language have traditionally been used for training language models to make the system output more fluent .
However , it is difficult to integrate language models in current NMT architectures .
Instead of ignoring such large monolingual corpora , exploited large corpora in the output language by translating a subset of them into the input language and then using the resulting synthetic sentence pairs as additional training data .
We translated monolingual English text into Russian using an English to Russian NMT system mirroring the one described in Section 2.1 , 1 and then employed the machine - translated Russian and perfect English sentence pairs as additional data to train the Russian - English MT system .
To select sentences for back - translation , we used a semi-supervised convolutional neural network classifier ( Chen and Huang , 2016 ) .
We sampled two million sentences from the English monolingual News Crawl 2015 & 2016 corpora according to their classifier scores , which reflect their similarity to the the English half of our development set .
Pervasive dropout Pervasive dropout prevents the NMT system from overfitting .
We apply the variant of Gal and Ghahramani ( 2016 ) pervasive dropout that is implemented in Nematus to all layers in the network .
This variant has the characteristic that the random dropout is applied at the token level , instead of at the word-type level .
We set the dropout probability for the source words , target words and embedding layers to 0.15 .
For the hidden layers , we set the dropout probability to 0.3 .
Minimum risk training Minimum risk training ( MRT ) ( Shen et al. , 2016 ) allows model optimization to arbitrary loss functions , which do not need to be differentiable , thus enabling direct model tuning against automatic MT evaluation metrics .
It uses the MT evaluation metric as the loss function and minimizes the expected loss on the training data at sentence - level .
We experimented with further model optimization using MRT on the whole training corpus against sentence BLEU at the final stage .
Greedy model averaging A common practice for avoiding overfitting to the training data is ensembling the last few models saved as checkpoints .
Recently , Junczys - Dowmunt et al. ( 2016 b ) showed that one can see nearly the same benefits by performing a component - wise average of all parameters across checkpoints .
We extended this technique by using a greedy strategy to average a wider range of models .
Instead of considering only the last few saved models , we considered 30 saved models having the best BLEU performance on the validation set one- by-one .
For each checkpoint , in descending order of BLEU score , we add the checkpoint to our running average to create a model candidate .
We then use the candidate to decode our development set .
If this results in improved BLEU , we accept the candidate , and it becomes our new running average .
We find that this process generally selects between 5 and 8 checkpoints to include in the average .
Portage - NRC WMT16 PBMT system
The core of the NRC WMT16 MT system ( Lo et al. , 2016 ) is Portage ( Larkin et al. , 2010 ) .
Portage is a conventional log-linear phrase - based SMT system .
The system was trained on all the Russian - English parallel training corpora and WMT 12 and WMT 13 Russian - English news translation test set and tuned on the WMT 14 test set .
Both the Russian and English text in the parallel and monolingual corpora in the training / development / test corpora were tokenized and lowercased .
The system employed Russian lemmatization extensively in building word alignments for translation models , a hierarchical distortion model , a sparse feature model and neural network joint models or NNJMs ( Devlin et al. , 2014 ) .
The system also made extensive use of monolingual English corpora in building language models .
Last but not least , it had comprehensive Russian OOV handling , which included a fallback Russian lemma-based phrase table and a Russian transliteration model .
Rescoring and truecasing We rescored 1000 - best lists output from the phrase - based decoder using a rescoring model ( Och et al. , 2004 ; Foster et al. , 2009 ) consisting of 13 features : 3 NMT models , 2 language models , 5 NNJMs and 3 n-best features .
The rescoring model was tuned using n-best MIRA ( Cherry and Foster , 2012 ) .
The three NMT systems used as rescoring features were : 1 ) baseline further trained with synthetic data , 2 ) dropout baseline further trained with synthetic data and with dropout turned off , and 3 ) the previous model optimized to the development set using minimum risk training .
The five NNJM rescoring features include two Russian - word NNJMs and three Russian - lemma ones .
Following Devlin et al. ( 2014 ) perspectives not available during decoding .
The Russian- lemma NNJMs are rescored using normal , target - to - source , and right - to - left perspectives .
The Russian - word NNJMs are rescored using normal and right- to - left perspectives .
The choice of which perspectives to include was made based on empirical devtest ( WMT 16 ) performance .
The two language models were : a left-to- right 6 - gram LM and a right- to- left 6 - gram LM .
Both were trained on the WMT 16 monolingual English training corpus ,
The final output was truecased and detokenized in the same way as described in Lo et al . ( 2016 ) .
Results
Table 1 shows the results of selected models from our development experiments .
It can be seen that synthetic training data generated by backtranslation of large output language monolingual corpora consistently improves the baseline by 1.4 to 2 BLEU .
However , this result is rather disappointing by comparison with the exciting improvement reported in Sennrich et al . ( 2016 a ) , i.e. 3 - 4 BLEU .
Another disappointing result is that model averaging does not work well with the dropout models .
We can see model averaging yields around 1 BLEU gain on non-dropout systems .
However , the improvement achieved by model averaging drops to 0 - 0.1 BLEU on dropout systems .
In other experiments not shown here , we also saw no improvement from ensembling the checkpoints of our dropout systems .
The most interesting observation in our experiments is that the dropout baseline continues to improve over the course of many weeks .
Figure 1 shows the learning curve of the selected models for all 7 weeks of development .
Line ( c ) of this figure shows that the dropout baseline continues training and improving until the end of the evaluation campaign , achieving a development BLEU score that is 2.7 BLEU points beyond our best single NMT system that does not use dropout .
This system can be further improved by adding synthetic data , as in line ( d ) , however , we found that we needed to switch dropout off after adding the synthetic data .
Although in figure 1 we see that none of the NMT systems manage to beat our WMT16 PBMT submission , the more interesting result is that there is more than 1.8 BLEU gain on the development set and 1.1 BLEU gain on the test set by rescoring the PBMT 1000 - best list using just one of our NMT systems and no other features , as in line ( g ) .
The final rescoring with weighted collections of NMT systems , language model features , NNJM features and n-best features shows 1.8 BLEU improvement over the WMT 16 submission on the test set .
Chinese -English news translation
We used all the Chinese-English parallel corpora available for the constrained news translation task .
They include the UN corpus , the NewsCommentary v12 corpus and the CWMT corpus .
In total , 25 million parallel Chinese - English sentences were used to train the baseline system .
We used half of the WMT 17 news translation development set as our development set and the other half as internal test set .
The English texts in the training / development / test corpora were tokenized and lowercased while the Chinese texts in the training / development / test corpora were segmented using the ICTCLAS segmenter ( Zhang et al. , 2003 ) .
Then the Chinese and English text were combined to train a BPE model with vocabulary size of 90k .
NMT baseline system Our Chinese-English NMT baseline system is similar to the Russian - English baseline as described in section 2.1 : Nematus - based , word embeddings with 512 dimensions , hidden layers with 1024 dimensions , etc .
Data selection and domain adaptation
Since the majority of the 25 million sentence pairs in the training corpus are general domain , we experimented with different data selection and domain adaptation techniques to further train the NMT system with data that are similar to the development set so as to perform better in the news domain .
Axelrod et al. ( 2011 ) introduced the bilingual language model cross-entropy difference as a similarity function for identifying sentence pairs from general - domain training corpora that are close to the target domain .
We built four language models using the input and output sides of the training corpora and the development set respectively to select 3 million sentence pairs from the training corpora that are close to the news domain .
However , the development set , which consists of only 1 k sentence pairs , is too tiny to be a suitable corpus for building the in-domain language models that will enable the bilingual LM crossentropy difference data selection method to work effectively .
Therefore , we also experimented with the semi-supervised convolutional neural network method in Chen and Huang ( 2016 ) to select 1 mil-lion sentence pairs from the training corpora that are close to the news domain .
Finally , we experimented with a cost weighting domain adaptation technique ( Chen et al. , 2017 ) .
This technique trains a domain classifier concurrently with the NMT system , and uses the classifier probabilities to weight training instances according to their similarity to the development set .
Synthetic training data
We generated synthetic Chinese and perfect English sentence pairs in a process similar to that described in section 2.2 .
We first used a semisupervised convolutional neural network classifier ( Chen and Huang , 2016 ) to sample 20 million sentences from the English monolingual News Crawl 2015 & 2016 corpora according to the development set .
We then translated the selected sentences using a English - Chinese NMT baseline trained out - of - the - box using only the parallel corpora .
Greedy model averaging Greedy model averaging is performed as described in section 2.5 .
Minimum risk training
In contrast to the way in which we carried out MRT for the Russian - English system in section 2.4 , we optimized the Chinese - English system using MRT against sentence BLEU only on the intersection of the subsets of corpora selected by the LM cross-entropy and the semi-supervised CNN in section 3.2 .
The size of the intersection of the two subsets of corpora is 300k sentence pairs .
Ensembling , rescoring and truecasing Applying different combinations of the techniques described in section 3.1 to 3.5 , we built 14 different NMT systems .
Their uncased BLEU on the test set ranged from 19.8 to 21.4 .
We ensembled all the systems together using Simplex - tuned weights .
We rescored 500 - best lists output from the ensembled NMT system using a rescoring model ( Och et al. , 2004 ; Foster et al. , 2009 ) consisting of 82 features : IBM models , RNN language models ( Mikolov et al. , 2010 ) , n-gram language models trained on different data subsets , neural network joint models ( NNJMs ) ( Devlin et al. , 2014 ) and word , n-gram , word alignment posteriors ( Foster et al. , 2009 ) , etc .
The rescoring model was tuned using n-best MIRA ( Cherry and Foster , 2012 ) .
The final output was truecased and detokenized using heuristic methods .
Results
Figure 2 shows that all the components we described in section 3.2 to 3.5 help improve the NMT system .
The uncased BLEU on the test set in table 2 shows that all the data selection and domain adaptation methods improve the NMT systems by 0.4 to 1.5 BLEU .
Similar to the results we ob-served in our Russian - English NMT systems , synthetic training data generated by back -translation of large output language monolingual corpora improved the NMT system score by 1 BLEU .
The most important observation in our experiments is that ensembling of NMT systems developed by different techniques achieves around 3 BLEU improvement and rescoring the n-best output from NMT systems also shows 1.4 BLEU gain on the test set .
Conclusion
We have presented the NRC submissions to the WMT 2017 Russian - English and Chinese-English news translation task .
The Russian - English submitted system is our WMT 16 PBMT system rescored by three NMT models and other rescoring features .
Our Chinese -English submitted system is an ensemble of fourteen NMT models rescored by a large set of additional features .
Our system achieved the highest score for the Russian - English ( among nine participants ) and the fourth highest score for Chinese - English ( among twenty participants ) constrained news translation tasks in WMT 2017 human evaluation .
Our experiences in WMT 2017 illustrate the sharp divide between large - and medium-scale data scenarios when working with neural MT .
For Russian - English , we found ourselves relying on techniques that are usually intended for lowresource scenarios , such as pervasive dropout and rescoring a phrase - based system .
This is surprising , as 2.5 million sentence pairs would have been considered a large - data scenario in the nottoo-distant past .
Meanwhile , for Chinese - English , we were able to achieve strong individual neural systems , which were further strengthened by ensembling across various data selection and data weighting techniques .
Our results also highlight the necessity to speed up convergence in the presence of dropout , so that it does not take weeks to train a single model .
Figure 1 : 1 Figure 1 : Russian- English learning curve on development set in cased BLEU of selected models : a) NMT baseline , b) NMT baseline further trained with synthetic data , c ) NMT dropout baseline , d) NMT dropout baseline further trained with synthetic data while dropout is turned off , e ) NMT dropout baseline with synthetic data optimized to sentence - level BLEU on the training data using MRT , f ) our WMT16 PBMT submission and g ) the PBMT rescored by one of the rescoring features .
