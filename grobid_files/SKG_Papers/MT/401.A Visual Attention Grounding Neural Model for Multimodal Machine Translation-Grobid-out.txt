title
A Visual Attention Grounding Neural Model for Multimodal Machine Translation

abstract
We introduce a novel multimodal machine translation model that utilizes parallel visual and textual information. Our model jointly optimizes the learning of a shared visuallanguage embedding and a translator. The model leverages a visual attention grounding mechanism that links the visual semantics with the corresponding textual semantics. Our approach achieves competitive state-of-the-art results on the Multi30K and the Ambiguous COCO datasets. We also collected a new multilingual multimodal product description dataset to simulate a real-world international online shopping scenario. On this dataset, our visual attention grounding model outperforms other methods by a large margin.

Introduction Multimodal machine translation is the problem of translating sentences paired with images into a different target language  (Elliott et al., 2016) . In this setting, translation is expected to be more accurate compared to purely text-based translation, as the visual context could help resolve ambiguous multi-sense words. Examples of real-world applications of multimodal (vision plus text) translation include translating multimedia news, web product information, and movie subtitles. Several previous endeavours  (Huang et al., 2016; Calixto et al., 2017a; Elliott and K?d?r, 2017)  have demonstrated improved translation quality when utilizing images. However, how to effectively integrate the visual information still remains a challenging problem. For instance, in the WMT 2017 multimodal machine translation challenge , methods that incorporated visual information did not outperform pure text-based approaches with a big margin. In this paper, we propose a new model called Visual Attention Grounding Neural Ma-chine Translation (VAG-NMT) to leverage visual information more effectively. We train VAG-NMT with a multitask learning mechanism that simultaneously optimizes two objectives: (1) learning a translation model, and (2) constructing a vision-language joint semantic embedding. In this model, we develop a visual attention mechanism to learn an attention vector that values the words that have closer semantic relatedness with the visual context. The attention vector is then projected to the shared embedding space to initialize the translation decoder such that the source sentence words that are more related to the visual semantics have more influence during the decoding stage. When evaluated on the benchmark Multi30K and the Ambiguous COCO datasets, our VAG-NMT model demonstrates competitive performance compared to existing state-of-the-art multimodal machine translation systems. Another important challenge for multimodal machine translation is the lack of a large-scale, realistic dataset. To our knowledge, the only existing benchmark is Multi30K  (Elliott et al., 2016) , which is based on an image captioning dataset, Flickr30K  (Young et al., 2014)  with manual German and French translations. There are roughly 30K parallel sentences, which is relatively small compared to text-only machine translation datasets that have millions of sentences such as WMT14 EN?DE. Therefore, we propose a new multimodal machine translation dataset called IKEA to simulate the real-world problem of translating product descriptions from one language to another. Our IKEA dataset is a collection of parallel English, French, and German product descriptions and images from IKEA's and UNIQLO's websites. We have included a total of 3,600 products so far and will include more in the future. 

 Related Work In the machine translation literature, there are two major streams for integrating visual information: approaches that (1) employ separate attention for different (text and vision) modalities, and (2) fuse visual information into the NMT model as part of the input. The first line of work learns independent context vectors from a sequence of text encoder hidden states and a set of location-preserving visual features extracted from a pre-trained convnet, and both sets of attentions affect the decoder's translation  (Calixto et al., 2017a; Helcl and Libovick?, 2017) . The second line of work instead extracts a global semantic feature and initializes either the NMT encoder or decoder to fuse the visual context  (Calixto et al., 2017b; Ma et al., 2017) . While both approaches demonstrate significant improvement over their Text-Only NMT baselines, they still perform worse than the best monomodal machine translation system from the WMT 2017 shared task  (Zhang et al., 2017) . The model that performs best in the multimodal machine translation task employed image context in a different way.  (Huang et al., 2016)  combine region features extracted from a region-proposal network  (Ren et al., 2015)  with the word sequence feature as the input to the encoder, which leads to significant improvement over their NMT baseline. The best multimodal machine translation system in WMT 2017  (Caglayan et al., 2017)  performs element-wise multiplication of the target language embedding with an affine transformation of the convnet image feature vector as the mixed input to the decoder. While this method outperforms all other methods in WMT 2017 shared task workshop, the advantage over the monomodal translation system is still minor. The proposed visual context grounding process in our model is closely related to the literature on multimodal shared space learning.  (Kiros et al., 2014)  propose a neural language model to learn a visual-semantic embedding space by optimizing a ranking objective, where the distributed representation helps generate image captions.  (Karpathy and Li, 2014)  densely align different objects in the image with their corresponding text captions in the shared space, which further improves the quality of the generated caption. In later work, multimodal shared space learning was extended to multimodal multilingual shared space learning.  (Calixto et al., 2017c ) learn a multi-modal multilin-gual shared space through optimization of a modified pairwise contrastive function, where the extra multilingual signal in the shared space leads to improvements in image-sentence ranking and semantic textual similarity task.  (Gella et al., 2017)  extend the work from  (Calixto et al., 2017c ) by using the image as the pivot point to learn the multilingual multimodal shared space, which does not require large parallel corpora during training. Finally,  (Elliott and K?d?r, 2017)  is the first to integrate the idea of multimodal shared space learning to help multimodal machine translation. Their multi-task architecture called "imagination" shares an encoder between a primary task of the classical encoder-decoder NMT and an auxiliary task of visual feature reconstruction. Our VAG-NMT mechanism is inspired by (Elliott and K?d?r, 2017), but has important differences. First, we modify the auxiliary task as a visual-text shared space learning objective instead of the simple image reconstruction objective. Second, we create a visual-text attention mechanism that captures the words that share a strong semantic meaning with the image, where the grounded visual-context has more impact on the translation. We show that these enhancements lead to improvement in multimodal translation quality over  (Elliott and K?d?r, 2017) . Given a set of parallel sentences in language X and Y , and a set of corresponding images V paired with each sentence pair, the model aims to translate sentences {x i } N i=1 ? X in language X to sentences {y i } N i=1 ? Y in language Y with the assistance of images {v i } N i=1 ? V . We treat the problem of multimodal machine translation as a joint optimization of two tasks: (1) learning a robust translation model and (2) constructing a visual-language shared embedding that grounds the visual semantics with text. Figure  1  shows an overview of our VAG-NMT model. We adopt a state-of-the-art attention-based sequenceto-sequence structure  (Bahdanau et al., 2014)  for translation. For the joint embedding, we obtain the text representation using a weighted sum of hidden states from the encoder of the sequenceto-sequence model and we obtain the image representation from a pre-trained convnet. We learn the weights using a visual attention mechanism, which represents the semantic relatedness between the image and each word in the encoded text. We learn the shared space with a ranking loss and the translation model with a cross entropy loss. The joint objective function is defined as: J(? T , ? V ) = ?J T (? T ) + (1 ? ?)J V (? V ), (1) where J T is the objective function for the sequence-to-sequence model, J V is the objective function for joint embedding learning, ? T are the parameters in the translation model, and ? V are the parameters for the shared vision-language embedding learning, and ? determines the contribution of the machine translation loss versus the visual grounding loss. Both J T and J V share the parameters of the encoder from the neural machine translation model. We describe details of the two objective functions in Section 3.2. 

 Encoder We first encode an n-length source sentence {x}, as a sequence of tokens x = {x 1 , x 2 , . . . , x n }, with a bidirectional GRU  (Schuster and Paliwal, 1997; . Each token is represented by a one-hot vector, which is then mapped into an embedding e i through a pre-trained embedding matrix. The bidirectional GRU processes the embedding tokens in two directions: left-toright (forward) and right-to-left (backward). At every time step, the encoder's GRU cell generates two corresponding hidden state vectors: ? ? h i = ? ? ? GRU (h i?1 , e i ) and ? ? h i = ? ? ? GRU (h i?1 , e i ). The two hidden state vectors are then concatenated together to serve as the encoder hidden state vector of the source token at step i: h i = [ ? ? h i , ? ? h i ]. 

 Shared embedding objective After encoding the source sentence, we project both the image and text into the shared space to find a good distributed representation that can capture the semantic meaning across the two modalities. Previous work has shown that learning a multimodal representation is effective for grounding knowledge between two modalities  (Kiros et al., 2014; Chrupala et al., 2015) . Therefore, we expect the shared encoder between the two objectives to facilitate the integration of the two modalities and positively influence translation during decoding. To project the image and the source sentence to a shared space, we obtain the visual embedding (v) from the pool5 layer of ResNet50  (He et al., 2015a)  pre-trained on ImageNet classification  (Russakovsky et al., 2015) , and the source sentence embedding using the weighted sum of encoder hidden state vectors ({h i }) to represent the entire source sentence (t). We project each {h i } to the shared space through an embedding layer. As different words in the source sentence will have different importance, we employ a visual-language attention mechanism-inspired by the attention mechanism applied in sequenceto-sequence models  (Bahdanau et al., 2014) -to emphasize words that have the stronger semantic connection with the image. For example, the highlighted word "cat" in the source sentence in Fig.  1  has the more semantic connection with the image. Specifically, we produce a set of weights ? = {? 1 , ? 2 , . . . , ? n } with our visual-attention mechanism, where the attention weight ? i for the i'th word is computed as: ? i = exp(z i ) N l=1 exp(z l ) , (2) and z i = tanh(W v v) ? tanh(W h h i ) is computed by taking the dot product between the transformed encoder hidden state vector h i and the transformed image feature vector v, and W v and W h are the association transformation parameters. Then, we can get a weighted sum of the encoder hidden state vectors t = n i=1 ? i h i to represent the semantic meaning of the entire source sentence. The next step is to project the source sentence feature vector t and the image feature vector v into the same shared space. The projected vector for text is: t emb = tanh(W t emb t + b t emb ) and the projected vector for image is: v emb = tanh(W v emb v + b v emb ). We follow previous work on visual semantic embedding  (Kiros et al., 2014)  to minimize a pairwise ranking loss to learn the shared space: JV (?V ) = p k max{0, ? ? s(vp, tp) + s(vp, t k =p )} + k p max{0, ? ? s(t k , v k ) + s(t k , v p =k )}, (3) where ? is a margin, and s is the cosine distance between two vectors in the shared space. k and p are the indexes of the images and text sentences, respectively. t k =p and v p =k are the contrastive examples with respect to the selected image and the selected source text, respectively. When the loss decreases, the distance between a paired image and sentence will drop while the distance between an unpaired image and sentence will increase. In addition to grounding the visual context into the shared encoder through the multimodal shared space learning, we also initialize the decoder with the learned attention vector t such that the words that have more relatedness with the visual semantics will have more impact during the decoding (translation) stage. However, we may not want to solely rely on only a few most important words. Thus, to produce the initial hidden state of the decoder, we take a weighted average of the attention vector t and the mean of encoder hidden states: s 0 = tanh(W init (?t + (1 ? ?) 1 N N i h i )), (4) where ? determines the contribution from each vector. Through our experiments, we find the best value for ? is 0.5. 

 Translation objective During the decoding stage, at each time step j, the decoder generates a decoder hidden state s j from a conditional GRU cell  whose input is the previously generated translation token y j?1 , the previous decoder hidden state s j?1 , and the context vector c j at the current time step: s j = cGRU(s j?1 , y j?1 , c j ) (5) The context vector c j is a weighted sum of the encoder hidden state vectors, and captures the relevant source words that the decoder should focus on when generating the current translated token y j . The weight associated with each encoder hidden state is determined by a feed-forward network. From the hidden state s j we can predict the conditional distribution of the next token y j with a fullyconnected layer W o given the previous token's language embedding e j?1 , the current hidden state d j and the context vector for current step c j : p(y j |y j?1 , x) = softmax(W o o t ), (6) where o t = tanh(W e e j?1 + W d d j + W c c j ). The three inputs are transformed with W e , W d , and W c , respectively and then summed before being fed into the output layer. We train the translation objective by optimizing a cross entropy loss function: J T (? T ) = ? j log p(y j |y j?1 , x) (7) By optimizing the objective of the translation and the multimodal shared space learning tasks jointly along with the visual-language attention mechanism, we can simultaneously learn a general mapping between the linguistic signals in two languages and grounding of relevant visual content in the text to improve the translation. 

 IKEA Dataset Previous available multimodal machine translation models are only tested on image caption datasets, we, therefore, propose a new dataset, IKEA, that has the real-world application of international online shopping. We create the dataset by crawling commercial products' descriptions and images from IKEA and UNIQLO websites. There are 3,600 products and we plan to expand the data in the future. Each sample is composed of the web-crawled English description of a product, an image of the product, and the web-crawled German or French description of the product. Different than the image caption datasets, the German or French sentences in the IKEA dataset is not an exact parallel translation of its English sentence. Commercial descriptions in different languages can be vastly different in surface form but still keep the core semantic meaning. We think IKEA is a good data set to simulate real-world multimodal translation problems. The sentence in the IKEA dataset contains 60-70 words on average, which is five times longer than the average text length in Multi30K  (Elliott et al., 2016) . These sentences not only describe the visual appearance of the product, but also the product usage. Therefore, capturing the connection between English ? German English ? French Method BLEU METEOR BLEU METEOR Imagination  (Elliott and K?d?r, 2017)   5 Experiments and Results 

 Datasets We evaluate our proposed model on three datasets: Multi30K  (Elliott et al., 2016) , Ambiguous COCO , and our newly-collected IKEA dataset. The Multi30K dataset is the largest existing human-labeled dataset for multimodal machine translation. It consists of 31,014 images, where each image is annotated with an English caption and manual translations of image captions in German and French. There are 29,000 instances for training, 1,014 instances for validation, and 1,000 for testing. Additionally, we also evaluate our model on the Ambiguous COCO Dataset collected in the WMT2017 multimodal machine translation challenge . It contains 461 images from the MSCOCO dataset  (Lin et al., 2014) , whose captions contain verbs with ambiguous meanings. 

 Setting We pre-process all English, French, and German sentences by normalizing the punctuation, lower casing, and tokenizing with the Moses toolkit. A Byte-Pair-Encoding (BPE)  (Sennrich et al., 2015)  operation with 10K merge operations is learned from the pre-processed data and then applied to segment words. We restore the original words by concatenating the subwords segmented by BPE in post-processing. During training, we apply early stopping if there is no improvement in BLEU score on validation data for 10 validation steps. We apply beam search decoding to generate translation with beam size equal to 12. We evaluate the performance of all models using BLEU  (Papineni et al., 2002)  and METEOR  (Denkowski and Lavie, 2014) . The setting used in IKEA dataset is the same as Multi30K, except that we lower the default batch size from 32 to 12; since IKEA dataset has long sentences and large variance in sentence length, we use smaller batches to make the training more stable. Full details of our hyperparameter choices can be found in Appendix B. We run all models five times with different random seeds and report the mean and standard deviation. 

 Results We compare the performance of our model against the state-of-the-art multimodal machine translation approaches and the text-only baseline. The idea of our model is inspired by the "Imagination" model  (Elliott and K?d?r, 2017) , which unlike our models, simply averages the encoder hidden states for visual grounding learning. As "Imagination" does not report its performance on Multi30K 2017 and Ambiguous COCO in its original paper, we directly use their result reported in the WMT 2017 shared task as a comparison. LIUMCVC is the best multimodal machine translation model in WMT 2017 multimodal machine translation challenge and exploits visual information with several different methods. We always compare our VAG-NMT with the method that has been reported to English ? German English ? French Method BLEU METEOR BLEU METEOR LIUMCVC-Multi 59.9 ? 1.9 63.8 ? 0.4 58.4 ? 1.6 64.6 ? 1.8 Text-Only NMT 61.9 ? 0.9 65.6 ? 0.9 65.2 ? 0.7 69.0 ? 0.2 VAG-NMT 63.5 ? 1.2 65.7 ? 0.1 65.8 ? 1.2 68.9 ? 1.4 Table  3 : Translation results on the IKEA dataset have the best performance on each dataset. Our VAG-NMT surpasses the results of the "Imagination" model and the LIUMCVC's model by a noticeable margin in terms of BLEU score on both the Multi30K dataset (Table  1 ) and the Ambiguous COCO dataset (Table  2 ). The METEOR score of our VAG-NMT is slightly worse than that of "Imagination" for English -> German on Ambiguous COCO Dataset. This is likely because the "Imagination" result was produced by ensembling the result of multiple runs, which typically leads to 1-2 higher BLEU and METEOR points compared to a single run. Thus, we expect our VAG-NMT to outperform the "Imagination" baseline if we also use an ensemble. We observe that our multimodal VAG-NMT model has equal or slightly better result compared to the text-only neural machine translation model on the Multi30K dataset. On the Ambiguous COCO dataset, our VAG-NMT demonstrates clearer improvement over this text-only baseline. We suspect this is because Multi30K does not have many cases where images can help improve translation quality, as most of the image captions are short and simple. In contrast, Ambiguous COCO was purposely curated such that the verbs in the captions can have ambiguous meaning. Thus, visual context will play a more important role in Ambiguous COCO; namely, to help clarify the sense of the source text and guide the translation to select the correct word in the target language. We then evaluate all models on the IKEA dataset. Table  3  shows the results. Our VAG-NMT has a higher value in BLEU and a comparable value in METEOR compared to the Text-only NMT baseline. Our VAG-NMT outperforms LI-UMCVC's multimodal system by a large margin, which shows that the LIUMCVC's multimodal's good performance on Multi30K does not generalize to this real-world product dataset. The good performance may come from the visual attention mechanism that learns to focus on text segments that are related to the images. Such attention there-fore teaches the decoder to apply the visual context to translate those words. This learned attention is especially useful for datasets with long sentences that have irrelevant text information with respect to the image.   

 Multimodal embedding results To assess the learned joint embedding, we perform an image retrieval task evaluated using the Recall@K metric  (Kiros et al., 2014)  on the Multi30K dataset. We project the image feature vectors V = {v 1 , v 2 , . . . , v n } and their corresponding captions S = {s 1 , s 2 , . . . , s n } into a shared space. We follow the experiments conducted by the previous visual semantic embedding work  (Kiros et al., 2014) , where for each embedded text vector, we find the closest image vectors around it based on the cosine similarity. Then we can compute the recall rate of the paired image in the top K nearest neighbors, which is also known as R@K score. The shared space learned with VAG-NMT achieves 64% R@1, 88.6% R@5, and 93.8% R@10 on Multi30K, which demonstrates the good quality of the learned shared semantics. We also achieved 58.13% R@1, 87.38% R@5 and 93.74% R@10 on IKEA dataset; 41.35% R@1, 85.48% R@5 and 92.56% R@10 on COCO dataset. Besides the quantitative results, we also show several qualitative results in Figure  2 . We show the top five images retrieved by the example captions.  The images share "cyclist", "helmet", and "dog" mentioned in the caption. 

 Human evaluation We use Facebook to hire raters that speak both German and English to evaluate German translation quality. As Text-Only NMT has the highest BLEU results among all baseline models, we compare the translation quality between the Text-Only and the VAG-NMT on all three datasets. We randomly selected 100 examples for evaluation for each dataset. The raters are informed to focus more on semantic meaning than grammatical correctness when indicating the preference of the two translations. They are also given the option to choose a tie if they cannot decide. We hired two raters and the inter-annotator agreement is 0.82 in Cohen's Kappa. We summarize the results in Table  4 , where we list the number of times that raters prefer one translation over another or think they are the same quality. Our VAG-NMT performs better than Text-Only NMT on MSCOCO and IKEA dataset, which correlates with the automatic evaluation metrics. However, the result of VAG-NMT is slightly worse than the Text-Only NMT on the Multi30K test dataset. This also correlates with the result of automatic evaluation metrics. Finally, we also compare the translation quality between LIUMCVC multimodal and VAG-NMT on 100 randomly selected examples from the IKEA dataset. VAG-NMT performs better than LIUMCVC multimodal. The raters prefer our VAG-NMT in 91 cases, LIUMCVC multimodal in 68 cases, and cannot tell in 47 cases.  

 Discussion To demonstrate the effectiveness of our visual attention mechanism, we show some qualitative examples in Figure  3 . Each row contains three images that share similar semantic meaning, which are retrieved by querying the image caption using our learned shared space. The original caption of each image is shown below each image. We highlight the three words in each caption that have the highest weights assigned by the visual attention mechanism. In the first row of Figure  3 , the attention mechanism assigns high weights to the words "skiing", "snowboarding", and "snow". In the second row, it assigns high attention to "rafting" or "raft" for every caption of the three images. These examples demonstrate evidence that our attention mechanism learns to assign high weights to words that have corresponding visual semantics in the image. We also find that our visual grounding attention captures the dependency between the words that Source Caption: a tennis player is moving to the side and is gripping his racquet with both hands . Text-Only NMT: ein tennisspieler bewegt sich um die seite und greift mit beiden h?nden an den boden . VAG-NMT: ein tennisspieler bewegt sich zur seite und greift mit beiden h?nden den schl?ger . Source Caption: three skiers skiing on a hill with two going down the hill and one moving up the hill . Text-Only NMT: drei skifahrer fahren auf skiern einen h?gel hinunter und eine person f?hrt den h?gel hinunter . VAG-NMT: drei skifahrer auf einem h?gel fahren einen h?gel hinunter und ein bewegt sich den h?gel hinauf . Source Caption: a blue , yellow and green surfboard sticking out of a sandy beach . Text-Only NMT: ein blau , gelb und gr?nes surfbrett streckt aus einem sandstrand . VAG-NMT: ein blau , gelb und gr?ner surfbrett springt aus einem sandstrand . have strong visual semantic relatedness. For example, in Figure  3 , words, such as "raft","river", and "water", with high attention appear in the image together. This shows that the visual dependence information is encoded into the weighted sum of attention vectors which is applied to initialize the translation decoder. When we apply the sequence-to-sequence model to translate a long sentence, the encoded visual dependence information strengthens the connection between the words with visual semantic relatedness. Such connections mitigate the problem of standard sequenceto-sequence models tending to forget distant history. This hypothesis is supported by the fact that our VAG-NMT outperforms all the other methods on the IKEA dataset which has long sentences. Lastly, in Figure  4  we provide some qualitative comparisons between the translations from VAG-NMT and Text-Only NMT. In the first example, our VAG-NMT properly translates the word "racquet" to "den schl?ger", while the Text-Only NMT mistranslated it to "den boden" which means "ground" in English. We suspect the attention mechanism and visual shared space capture the visual dependence between the word "tennis" and "racquet". In the second example, our VAG-NMT model correctly translates the preposition "up" to "hinauf" but Text-Only NMT mistranslates it to "hinunter" which means "down" in English. We consistently observe that VAG-NMT translates prepositions better than Text-Only NMT. We think it is because the pre-trained convnet features captured the relative object position that leads to a better preposition choice. Finally, in the third example, we show a failure case where Text-Only NMT generates a better translation. Our VAG-NMT mistranslates the verb phrase "sticking out" to "springt aus" which means "jump out" in German, while Text-Only NMT translates to "streckt aus", which is correct. We find that VAG-NMT often makes mistakes when translating verbs. We think it is because the image vectors are pretrained on an object classification task, which does not have any human action information. 

 Conclusion and Future Work We proposed a visual grounding attention structure to take advantage of the visual information to perform machine translation. The visual attention mechanism and visual context grounding module help to integrate the visual content into the sequence-to-sequence model, which leads to better translation quality compared to the model with only text information. We achieved stateof-the-art results on the Multi30K and Ambiguous COCO dataset. We also proposed a new product dataset, IKEA, to simulate a real-world online product description translation challenge. In the future, we will continue exploring different methods to ground the visual context into the translation model, such as learning a multimodal shared space across image, source language text, as well as target language text. We also want to change the visual pre-training model from an image classification dataset to other datasets that have both objects and actions, to further improve translation performance. value ? to 0.5. During training, we use Adam (Kingma and Ba, 2014) to optimize our model with a learning rate of 4e ? 4 for German Dataset and 1e ? 3 for French dataset. The batch size is 32. The total gradient norm is clipped to 1  (Pascanu et al., 2012) . Dropout is applied at the embedding layer in the encoder, context vectors extracted from the encoder and the output layer of the decoder. For Multi30K German dataset the dropout probabilities are (0.3, 0.5, 0.5) and for Multi30K French dataset the dropout probabilities are (0.2, 0.4, 0.4). For the Multimodal shared space learning objective function, the margin size ? is set to 0.1. The objective split weight ? is set to 0.99. We initialize the weights of all the pawith the method introduced in  (He et al., 2015b) . 
