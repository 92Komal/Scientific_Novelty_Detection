title
When a Good Translation is Wrong in Context: Context-Aware Machine Translation Improves on Deixis, Ellipsis, and Lexical Cohesion

abstract
Though machine translation errors caused by the lack of context beyond one sentence have long been acknowledged, the development of context-aware NMT systems is hampered by several problems. Firstly, standard metrics are not sensitive to improvements in consistency in document-level translations. Secondly, previous work on context-aware NMT assumed that the sentence-aligned parallel data consisted of complete documents while in most practical scenarios such document-level data constitutes only a fraction of the available parallel data. To address the first issue, we perform a human study on an English-Russian subtitles dataset and identify deixis, ellipsis and lexical cohesion as three main sources of inconsistency. We then create test sets targeting these phenomena. To address the second shortcoming, we consider a set-up in which a much larger amount of sentence-level data is available compared to that aligned at the document level. We introduce a model that is suitable for this scenario and demonstrate major gains over a context-agnostic baseline on our new benchmarks without sacrificing performance as measured with BLEU. 1

Introduction With the recent rapid progress of neural machine translation (NMT), translation mistakes and inconsistencies due to the lack of extra-sentential context are becoming more and more noticeable among otherwise adequate translations produced by standard context-agnostic NMT systems  (L?ubli et al., 2018) . Though this problem has recently triggered a lot of attention to contextaware translation  (Jean et al., 2017a; Wang et al., 2017; Tiedemann and Scherrer, 2017 ; Bawden  1  We release code and data sets at https://github.com/lena-voita/ good-translation-wrong-in-context.  Maruf and Haffari, 2018; Agrawal et al., 2018; Miculicich et al., 2018; Zhang et al., 2018) , the progress and widespread adoption of the new paradigm is hampered by several important problems. Firstly, it is highly non-trivial to design metrics which would reliably trace the progress and guide model design. Standard machine translation metrics (e.g., BLEU) do not appear appropriate as they do not sufficiently differentiate between consistent and inconsistent translations  (Wong and Kit, 2012) .  2  For example, if multiple translations of a name are possible, forcing consistency is essentially as likely to make all occurrences of the name match the reference translation as making them all different from the reference. Second, most previous work on context-aware NMT has made the assumption that all the bilingual data is available at the document level. However, isolated parallel sentences are a lot easier to acquire and hence only a fraction of the parallel data will be at the document level in any practical scenario. In other words, a context-aware model trained only on documentlevel parallel data is highly unlikely to outperform a context-agnostic model estimated from much larger sentence-level parallel corpus. This work aims to address both these shortcomings. A context-agnostic NMT system would often produce plausible translations of isolated sentences, however, when put together in a document, these translations end up being inconsistent with each other. We investigate which linguistic phenomena cause the inconsistencies using the OpenSubtitles  (Lison et al., 2018)  corpus for the English-Russian language pair. We identify deixis, ellipsis and lexical cohesion as three main sources of the violations, together amounting to about 80% of the cases. We create test sets focusing specifically on the three identified phenomena (6000 examples in total). We show that by using a limited amount of document-level parallel data, we can already achieve substantial improvements on these benchmarks without negatively affecting performance as measured with BLEU. Our approach is inspired by the Deliberation Networks  (Xia et al., 2017) . In our method, the initial translation produced by a baseline context-agnostic model is refined by a context-aware system which is trained on a small document-level subset of parallel data. The key contributions are as follows: ? we analyze which phenomena cause contextagnostic translations to be inconsistent with each other; ? we create test sets specifically addressing the most frequent phenomena; ? we consider a novel and realistic set-up where a much larger amount of sentencelevel data is available compared to that aligned at the document level; ? we introduce a model suitable for this scenario, and demonstrate that it is effective on our new benchmarks without sacrificing performance as measured with BLEU. 

 Analysis We begin with a human study, in which we: 1. identify cases when good sentence-level translations are not good when placed in context of each other, 2. categorize these examples according to the phenomena leading to a discrepancy in translations of consecutive sentences. The test sets introduced in Section 3 will then target the most frequent phenomena. 

 Human annotation To find what makes good context-agnostic translations incorrect when placed in context of each other, we start with pairs of consecutive sentences. We gather data with context from the publicly available OpenSubtitles2018 corpus (  2018) for English and Russian. We train a contextagnostic Transformer on 6m sentence pairs. Then we translate 2000 pairs of consecutive sentences using this model. For more details on model training and data preprocessing, see Section 5.3. Then we use human annotation to assess the adequacy of the translations without context and in the context of each other. The whole process is two-stage: 1. sentence-level evaluation: we ask if the translation of a given sentence is good, 2. evaluation in context: for pairs of consecutive good translations according to the first stage, we ask if the translations are good in context of each other. In the first stage, the annotators are instructed to mark as "good" translations which (i) are fluent sentences in the target language (in our case, Russian) (ii) can be reasonable translations of a source sentence in some context. For the second stage we only consider pairs of sentences with good sentence-level translations. The annotators are instructed to mark translations as bad in context of each other only if there is no other possible interpretation or extra additional context which could have made them appropriate. This was made to get more robust results, avoiding the influence of personal preferences of the annotators (for example, for using formal or informal speech), and excluding ambiguous cases that can only be resolved with additional context. The statistics of answers are provided in Table 1. We find that our annotators labelled 82% of sentence pairs as good translations. In 11% of cases, at least one translation was considered bad at the sentence level, and in another 7%, the sentences were considered individually good, but bad in context of each other. This indicates that in our setting, a substantial proportion of translation errors are only recognized as such in context.    

 Types of phenomena From the results of the human annotation, we take all instances of consecutive sentences with good translations which become incorrect when placed in the context of each other. For each, we identify the language phenomenon which caused a discrepancy. The results are provided in Table  2 . Below we discuss these types of phenomena, as well as problems in translation they cause, in more detail. In the scope of current work, we concentrate only on the three most frequent phenomena. 

 Deixis In this category, we group several types of deictic words or phrases, i.e. referential expressions whose denotation depends on context. This includes personal deixis ("I", "you"), place deixis ("here", "there"), and discourse deixis, where parts of the discourse are referenced ("that's a good question."). Most errors in our annotated corpus are related to person deixis, specifically gender marking in the Russian translation, and the T-V distinction between informal and formal you  (Latin "tu" and "vos") . In many cases, even when having access to neighboring sentences, one cannot make a confident decision which of the forms should be used, as there are no obvious markers pointing to one form or another (e.g., for the T-V distinction, words such as "officer", "mister" for formal and "honey", "dude" for informal). However, when  pronouns refer to the same person, the pronouns, as well as verbs that agree with them, should be translated using the same form. See Figure  1 (a) for an example translation that violates T-V consistency. Figure  1 (b) shows an example of inconsistent first person gender (marked on the verb), although the speaker is clearly the same. Anaphora are a form of deixis that received a lot of attention in MT research, both from the perspective of modelling (Le Nagard and  Koehn, 2010; Hardmeier and Federico, 2010; Jean et al., 2017b; Bawden et al., 2018; Voita et al., 2018, among others)  and targeted evaluation  (Hardmeier et al., 2015; Guillou and Hardmeier, 2016; M?ller et al., 2018) , and we list anaphora errors separately, and will not further focus on them. 

 Ellipsis Ellipsis is the omission from a clause of one or more words that are nevertheless understood in the context of the remaining elements. In machine translation, elliptical constructions in the source language pose a problem if the target language does not allow the same types of ellipsis (requiring the elided material to be predicted from context), or if the elided material affects the syntax of the sentence; for example, the grammatical function of a noun phrase and thus its inflection in Russian may depend on the elided verb (   elided subject. Our analysis focuses on ellipses that can only be understood and translated with context beyond the sentence-level. This has not been studied extensively in MT research.  3  We classified ellipsis examples which lead to errors in sentence-level translations by the type of error they cause. Results are provided in Table  4 . It can be seen that the most frequent problems related to ellipsis that we find in our annotated corpus are wrong morphological forms, followed by wrongly predicted verbs in case of verb phrase ellipsis in English, which does not exist in Russian, thus requiring the prediction of the verb in the Russian translation (Figure  2(b) ). 

 Lexical cohesion Lexical cohesion has been studied previously in MT  (Tiedemann, 2010; Gong et al., 2011; Wong and Kit, 2012; Kuang et al., 2018; Miculicich et al., 2018, among others) . There are various cohesion devices  (Morris and Hirst, 1991) , and a good translation should exhibit lexical cohesion beyond the sentence level. We   

 Test Sets For the most frequent phenomena from the above analysis we create test sets for targeted evaluation. Each test set contains contrastive examples. It is specifically designed to test the ability of a system to adapt to contextual information and handle the phenomenon under consideration. Each test instance consists of a true example (sequence of sentences and their reference translation from the data) and several contrastive translations which differ from the true one only in the considered aspect. All contrastive translations we use are correct plausible translations at a sentence level, and only context reveals the errors we introduce. All the test sets are guaranteed to have the necessary context in the provided sequence of 3 sentences. The system is asked to score each candidate example, and we compute the system accuracy as the proportion of times the true translation is preferred over the contrastive ones. Test set statistics are shown in Table  5 . 

 Deixis From construct for this category tests the ability of a machine translation system to produce translations with consistent level of politeness. We semi-automatically identify sets of consecutive sentences with consistent politeness markers on pronouns and verbs (but without nominal markers such as "'Mr." or "officer") and switch T and V forms. Each automatic step was followed by human postprocessing, which ensures the quality of the final test sets.  4  This gives us two sets of translations for each example, one consistently informal (T), and one consistently formal (V). For each, we create an inconsistent contrastive example by switching the formality of the last sentence. The symmetry of the test set ensures that any contextagnostic model has 50% accuracy on the test set. 

 Ellipsis From Table  4 , we see that the two most frequent types of ambiguity caused by the presence of an elliptical structure have different nature, hence we construct individual test sets for each of them. Ambiguity of the first type comes from the inability to predict the correct morphological form of some words. We manually gather examples with such structures in a source sentence and change the morphological inflection of the relevant target phrase to create contrastive translation. Specifically, we focus on noun phrases where the verb is elided, and the ambiguity lies in how the noun phrase is inflected. The second type we evaluate are verb phrase ellipses. Mostly these are sentences with an auxiliary verb "do" and omitted main verb. We manually gather such examples and replace the translation of the verb, which is only present on the target side, with other verbs with different meaning, but the same inflection. Verbs which are used to construct such contrastive translations are the top-10 lemmas of translations of the verb "do" which we get from the lexical table of Moses  (Koehn et al., 2007)  induced from the training data. 

 Lexical cohesion Lexical cohesion can be established for various types of phrases and can involve reiteration or other semantic relations. In the scope of the current work, we focus on the reiteration of entities, since these tend to be non-coincidental, and can be easily detected and transformed. We identify named entities with alternative translations into Russian, find passages where they are translated consistently, and create contrastive test examples by switching the translation of some instances of the named entity. For more details, please refer to the appendix. 

 Model and Setting 

 Setting Previous work on context-aware neural machine translation used data where all training instances have context. This setting limits the set of available training sets one can use: in a typical scenario, we have a lot of sentence-level parallel data and only a small fraction of document-level data. Since machine translation quality depends heavily on the amount of training data, training a contextaware model is counterproductive if this leads to ignoring the majority of available sentence-level data and sacrificing general quality. We will also show that a naive approach to combining sentencelevel and document-level data leads to a drop in performance. In this work, we argue that it is important to consider an asymmetric setting where the amount of available document-level data is much smaller than that of sentence-level data, and propose an approach specifically targeting this scenario. 

 Model We introduce a two-pass framework: first, the sentence is translated with a context-agnostic model, and then this translation is refined using context of several previous sentences (context includes source sentences as well as their translations). We expect this architecture to be suitable in the proposed setting: the baseline context-agnostic model can be trained on a large amount of sentence-level Let D sent = {(x i , y i )} N i=1 denote the sentencelevel data with n paired sentences and D doc = {(x j , y j , c j )} M j=1 denote the document-level data, where (x j , y j ) is source and target sides of a sentence to be translated, c j are several preceding sentences along with their translations. Base model For the baseline context-agnostic model we use the original Transformerbase  (Vaswani et al., 2017) , trained to maximize the sentence-level log-likelihood 1 N (x i ,y i )?Dsent log P (y i |x i , ? B ). Context-aware decoder (CADec) The contextaware decoder is trained to correct translations given by the base model using contextual infor-mation. Namely, we maximize the following document-level log-likelihood: 1 M (x j ,y j )?D doc log E y B j ?P (y|x j ,? B ) P (y j |x j , y B j , c j , ? C ), where y B j is sampled from P (y|x j , ? B ). CADec is composed of a stack of N = 6 identical layers and is similar to the decoder of the original Transformer. It has a masked self-attention layer and attention to encoder outputs, and additionally each layer has a block attending over the outputs of the base decoder (Figure  4 ). We use the states from the last layer of the base model's encoder of the current source sentence and all context sentences as input to the first multi-head attention. For the second multi-head attention we input both last states of the base decoder and the target-side token embedding layer; this is done for translations of the source and also all context sentences. All sentence representations are produced by the base model. To encode the relative position of each sentence, we concatenate both the encoder and decoder states with one-hot vectors representing their position (0 for the source sentence, 1 for the immediately preceding one, etc). These distance embeddings are shown in blue in Figure  4 . 

 Experiments 

 Training At training time, we use reference translations as translations of the previous sentences. For the cur-rent sentence, we either sample a translation from the base model or use a corrupted version of the reference translation. We propose to stochastically mix objectives corresponding to these versions: 1 M (x j ,y j )?D doc log b j ? P (y j |x j , ?j , c j , ? C ))+ + (1 ? b j ) ? P (y j |x j , y B j , c j , ? C ) , where ?j is a corrupted version of the reference translation and b j ? {0, 1} is drawn from Bernoulli distribution with parameter p, p = 0.5 in our experiments. Reference translations are corrupted by replacing 20% of their tokens with random tokens. We discuss the importance of the proposed training strategy, as well as the effect of varying the value of p, in Section 6.5. 

 Inference As input to CADec for the current sentence, we use the translation produced by the base model. Target sides of the previous sentences are produced by our two-stage approach for those sentences which have context and with the base model for those which do not. We use beam search with a beam of 4 for all models. 

 Data and setting We use the publicly available OpenSubtitles2018 corpus  (Lison et al., 2018)  for English and Russian. As described in detail in the appendix, we apply data cleaning after which only a fraction of data has context of several previous sentences. We use up to 3 context sentences in this work. We randomly choose 6 million training instances from the resulting data, among which 1.5m have context of three sentences. We randomly choose two subsets of 10k instances for development and testing and construct our contrastive test sets from 400k held-out instances from movies not encountered in training. The hyperparameters, preprocessing and training details are provided in the supplementary material. 

 Results We evaluate in two different ways: using BLEU for general quality and the proposed contrastive test sets for consistency. We show that models indistinguishable with BLEU can be very different in terms of consistency. We randomly choose 500 out of 2000 examples from the lexical cohesion set and 500 out of 3000 from the deixis test set for validation and leave the rest for final testing. We compute BLEU on the development set as well as scores on lexical cohesion and deixis development sets. We use convergence in both metrics to decide when to stop training. The importance of using both criteria is discussed in Section 6.4. After the convergence, we average 5 checkpoints and report scores on the final test sets. 

 Baselines We consider three baselines. baseline The context-agnostic baseline is Transformer-base trained on all sentence-level data. Recall that it is also used as the base model in our 2-stage approach. concat The first context-aware baseline is a simple concatenation model. It is trained on 6m sentence pairs, including 1.5m having 3 context sentences. For the concatenation baseline, we use a special token separating sentences (both on the source and target side). s-hier-to-2.tied This is the version of the model s-hier-to-2 introduced by  Bawden et al. (2018) , where the parameters between encoders are shared  (M?ller et al., 2018) . The model has an additional encoder for source context, whereas the target side of the corpus is concatenated, in the same way as for the concatenation baseline. Since the model is suitable only for one context sentence, it is trained on 6m sentence pairs, including 1.5m having one context sentence. We chose s-hier-to-2.tied as our second context-aware baseline because it also uses context on the target side and performed best in a contrastive evaluation of pronoun translation  (M?ller et al., 2018) . 

 General results BLEU scores for our model and the baselines are given in Table  6 .  5  For context-aware models, all sentences in a group were translated, and then only the current sentence is evaluated. We also report BLEU for the context-agnostic baseline trained only on 1.5m dataset to show how the performance is influenced by the amount of data. We observe that our model is no worse in BLEU than the baseline despite the second-pass model being trained only on a fraction of the data. In contrast, the concatenation baseline, trained on a mixture of data with and without context is about 1 BLEU below the context-agnostic baseline and our model when using all 3 context sentences. CADec's performance remains the same independently from the number of context sentences (1, 2 or 3) as measured with BLEU. s-hier-to-2.tied performs worst in terms of BLEU, but note that this is a shallow recurrent model, while others are Transformer-based. It also suffers from the asymmetric data setting, like the concatenation baseline. 

 Consistency results Scores on the deixis, cohesion and ellipsis test sets are provided in Tables  7 and 8 . For all tasks, we observe a large improvement from using context. For deixis, the concatenation model (concat) and CADec improve over the baseline by 33.5 and 31.6 percentage points, respectively. On the lexical cohesion test set, CADec shows a large improvement over the context-agnostic baseline (12.2 percentage points), while concat performs similarly to the baseline. For ellipsis, both models improve substantially over the baseline (by 19-51 percentage points), with concat stronger for inflection tasks and CADec stronger for VPellipsis. Despite its low BLEU score, s-hier-to-2.tied also shows clear improvements over the context-agnostic baseline in terms of consistency, but underperforms both the concatenation model and CADec, which is unsurprising given that it uses only one context sentence. When looking only at the scores where the latest relevant context is in the model's context window (column 2 in Table  7 ), s-hier-to-2.tied outperforms the concatenation baseline for lexical cohesion, but remains behind the performance of CADec.  which are otherwise identical in terms of BLEU: the performance of the baseline and CADec is the same when measured with BLEU, but very different in terms of handling contextual phenomena. 

 Context-aware stopping criteria Figure  5  shows that for context-aware models, BLEU is not sufficient as a criterion for stopping: even when a model has converged in terms of BLEU, it continues to improve in terms of consistency. For CADec trained with p = 0.5, BLEU score has stabilized after 40k batches, but the lexical cohesion score continues to grow.  

 Ablation: using corrupted reference At training time, CADec uses either a translation sampled from the base model or a corrupted reference translation as the first-pass translation of the current sentence. The purpose of using a corrupted reference instead of just sampling is to teach CADec to rely on the base translation and not to change it much. In this section, we discuss the importance of the proposed training strategy. Results for different values of p are given in Table 9. All models have about the same BLEU, not statistically significantly different from the baseline, but they are quite different in terms of incorporating context. The denoising positively influences almost all tasks except for deixis, yielding the largest improvement on lexical cohesion. 

 Additional Related Work In concurrent work,  also propose a two-pass context-aware translation model inspired by deliberation network. However, while they consider a symmetric data scenario where all available training data has document-level context, and train all components jointly on this data, we focus on an asymmetric scenario where we have a large amount of sentence-level data, used to train our first-pass model, and a smaller amount of document-level data, used to train our secondpass decoder, keeping the first-pass model fixed. Automatic evaluation of the discourse phenomena we consider is challenging. For lexical cohesion,  Wong and Kit (2012)  count the ratio between the number of repeated and lexically similar content words over the total number of content words in a target document. However,  Guillou (2013) ;  Carpuat and Simard (2012)  find that translations generated by a machine translation system tend to be similarly or more lexically consistent, as measured by a similar metric, than human ones. This even holds for sentence-level systems, where the increased consistency is not due to improved co-hesion, but accidental -  Ott et al. (2018)  show that beam search introduces a bias towards frequent words, which could be one factor explaining this finding. This means that a higher repetition rate does not mean that a translation system is in fact more cohesive, and we find that even our baseline is more repetitive than the human reference. 

 Conclusions We analyze which phenomena cause otherwise good context-agnostic translations to be inconsistent when placed in the context of each other. Our human study on an English-Russian dataset identifies deixis, ellipsis and lexical cohesion as three main sources of inconsistency. We create test sets focusing specifically on the identified phenomena. We consider a novel and realistic set-up where a much larger amount of sentence-level data is available compared to that aligned at the document level and introduce a model suitable for this scenario. We show that our model effectively handles contextual phenomena without sacrificing general quality as measured with BLEU despite using only a small amount of document-level data, while a naive approach to combining sentence-level and document-level data leads to a drop in performance. We show that the proposed test sets allow us to distinguish models (even though identical in BLEU) in terms of their consistency. To build context-aware machine translation systems, such targeted test sets should prove useful, for validation, early stopping and for model selection. Improving the transformer translation model with document-level context. In Proceedings of the 2018 Conference on Empirical Methods in Natural Language Processing, pages 533-542, Brussels, Belgium. Association for Computational Linguistics. 

 A Protocols for test sets In this section we describe the process of constructing the test suites. 

 A.1 Deixis English second person pronoun "you" may have three different interpretations important when translating into Russian: the second person singular informal (T form), the second person singular formal (V form) and second person plural (there is no T-V distinction for the plural from of second person pronouns). Morphological forms for second person singular (V form) and second person plural pronoun are the same, that is why to automatically identify examples in the second person polite form, we look for morphological forms corresponding to second person plural pronouns. To derive morphological tags for Russian, we use publicly available pymorphy2 6  (Korobov, 2015) . Below, all the steps performed to obtain the test suite are described in detail. 

 A.1.1 Automatic identification of politeness For each sentence we try to automatically find indications of using T or V form. Presence of the following words and morphological forms are used as indication of usage of T/V forms: 1. second person singular or plural pronoun, 2. verb in a form corresponding to second person singular/plural pronoun, 3. verbs in imperative form, 4. possessive forms of second person pronouns. For 1-3 we used morphological tags predicted by pymorphy2, for 4th we used hand-crafted lists of forms of second person pronouns, because pymorphy2 fails to identify them. The first rule is needed as morphological forms for second person plural and second person singular V form pronouns and related verbs are the same, and there is no simple and reliable way to distinguish these two automatically. The second rule is to exclude cases where there is only one appropriate level of politeness according to the relation between the speaker and the listener. Such markers include "Mr.", "Mrs.", "officer", "your honour" and "sir". For the impolite form, these include terms denoting family relationship ("mom", "dad"), terms of endearment ("honey", "sweetie") and words like "dude" and "pal". 

 A.1.3 Automatic change of politeness To construct contrastive examples aiming to test the ability of a system to produce translations with consistent level of politeness, we have to produce an alternative translation by switching the formality of the reference translation. First, we do it automatically: 1. change the grammatical number of second person pronouns, verbs, imperative verbs, 2. change the grammatical number of possessive pronouns. For the first transformation we use pymorphy2, for the second use manual lists of possessive second person pronouns, because pymorphy2 can not change them automatically. 

 A.1.4 Human postprocessing of automatic change of politeness We manually correct the translations from the previous step. Mistakes of the described automatic change of politeness happen because of: 1. ambiguity arising when imperative and indicative verb forms are the same, 2. inability of pymorphy2 to inflect the singular number to some verb forms (e.g., to inflect singular number to past tense verbs), 3. presence of related adjectives, which have to agree with the pronoun, 4. ambiguity arising when a plural form of a pronoun may have different singular forms. A.1.5 Human annotation: are both polite and impolite versions appropriate? After the four previous steps, we have text fragments of several consecutive sentences with consistent level of politeness. Each fragment uses second person singular pronouns, either T form or V form, without nominal markers indicating which of the forms is the only one appropriate. For each group we have both the original version, and the version with the switched formality. To control for appropriateness of both levels of politeness in the context of a whole text fragment we conduct a human annotation. Namely, humans are given both versions of the same text fragment corresponding to different levels of politeness, and asked if these versions are natural. The answers they can pick are the following: 1. both appropriate, 2. polite version is not appropriate, 3. impolite version is not appropriate, 4. both versions are bad. The annotators are not given any specific guidelines, and asked to answer according to their intuition as a native speaker of the language (Russian). There are a small number of examples where one of the versions is not appropriate and not equally natural as the other one: 4%. Cases where annotators claimed both versions to be bad come from mistakes in target translations: OpenSubtitles data is not perfect, and target sides contain translations which are not reasonable sentences in Russian. These account for 1.5% of all examples. We do not include these 5.5% of examples in the resulting test sets. 

 A.2 Lexical cohesion The process of creating the lexical cohesion test set consists of several stages: 1. find passages where named entities are translated consistently, 2. extract alternative translations for these named entities from the lexical table of Moses  (Koehn et al., 2007)  induced from the training data, 3. construct alternative translations of each example by switching the translation of instances of the named entity, 4. for each example construct several test instances. 

 A.2.1 Identification of examples with consistent translations We look for infrequent words that are translated consistently in a text fragment. Since the target language has rich morphology, to verify that translations are the same we have to use lemmas of the translations. More precisely, we 1. train Berkeley aligner on about 6.5m sentence pairs from both training and held-out data, 2. find lemmas of all words in the reference translations in the held-out data using pymorphy2, 3. find words in the source which are not in the 5000 most frequent words in our vocabulary whose translations have the same lemma. 

 A.2.2 Finding alternative translations For the words under consideration, we find alternative translations which would be (i) equally appropriate in the context of the remaining sentence and text fragment (ii) possible for the model to produce. To address the first point, we focus on named entities, and we assume that all translations of a given named entity seen in the training data are appropriate. To address the second point, we choose alternative translations from the reference translations encountered in the training data, and pick only ones with a probability at least 10%. The sequence of actions is as follows: 1. train Moses on the training data (6m sentence pairs), 2. for each word under consideration (from A.2.1), get possible translations from the lexical table of Moses, We use warmup_steps = 16000, scale = 4 for the models trained on 6m data (baseline (6m) and concatenation) and scale = 1 for the models trained on 1.5m data (baseline (1.5m) and CADec). Figure 1 : 1 Figure 1: Examples of violation of (a) T-V form consistency, (b) speaker gender consistency. In color: (a) red -V-form, blue -T-form; (b) redfeminine, blue -masculine. 

 Figure 2(a)), or the verb inflection may depend on the 

 Figure 2 : 2 Figure 2: Examples of discrepancies caused by ellipsis. (a) wrong morphological form, incorrectly marking the noun phrase as a subject. (b) correct meaning is "see", but MT produces ? khoteli ("want"). 

 (a) EN Not for Julia. Julia has a taste for taunting her victims. RU ? ? ?. ? ? ? ? ?. RU Ne dlya Dzhulii. Yuliya umeyet draznit' svoikh zhertv. (b) EN But that's not what I'm talking about. I'm talking about your future. RU ? ? ? ? ? ?. ? ? ? ?. RU No ya govoryu ne ob etom. Rech' o tvoyom budushchem. 

 Figure 3 : 3 Figure 3: Examples of lack of lexical cohesion in MT. (a) Name translation inconsistency. (b) Inconsistent translation. Using either of the highlighted translations consistently would be good. 

 Figure 4 : 4 Figure 4: Model architecture 

 Figure 5 : 5 Figure 5: BLEU and lexical cohesion accuracy on the development sets during CADec training. 

 Table 1 : 1 Human annotation statistics of pairs of consecutive translation. 

 Table 2 2 : Types of phenomena causing discrepancy in context-agnostic translation of consecutive sentences when placed in the context of each other type of discrepancy frequency T-V distinction 67% speaker/addressee gender: same speaker 22% different speaker 9% other 2% 

 Table 3 : 3 Types of discrepancy in context-agnostic translation caused by deixis (excluding anaphora) 

 Table 4 : 4 Types of discrepancy in context-agnostic translation caused by ellipsis (a) EN You call her your friend but have you been to her home ? Her work ? RU ? ? ? ? ?, ? ? ? ? ? ?? ? ?? RU Ty nazyvayesh' yeyo svoyey podrugoy, no ty byl u neye doma? Yeyo rabota? (b) EN Veronica, thank you, but you saw what happened. We all did. RU ?, ?, ? ? ?, ? ?. ? ? ?. RU Veronika, spasibo, no ty videla, chto proizoshlo. My vse khoteli. 

 Table 3 3 latest relevant context total 1st 2nd 3rd deixis 3000 1000 1000 1000 lex. cohesion 2000 855 630 515 ellipsis (infl.) 500 ellipsis (VP) 500 Table 5: Size of test sets: total number of test instances and with regard to the latest context sentence with po- liteness indication or with the named entity under con- sideration. For ellipsis, we distinguish whether model has to predict correct noun phrase inflection, or correct verb sense (VP ellipsis). , we see that the most frequent error category related to deixis in our annotated corpus is the inconsistency of T-V forms when translating second person pronouns. The test set we 

 Table 7 : 7 Accuracy for deixis and lexical cohesion. latest relevant context total 1st 2nd 3rd deixis baseline 50.0 50.0 50.0 50.0 concat 83.5 88.8 85.6 76.4 s-hier-to-2.tied 60.9 83.0 50.1 50.0 CADec 81.6 84.6 84.4 75.9 lexical cohesion baseline 45.9 46.1 45.9 45.4 concat 47.5 48.6 46.7 46.7 s-hier-to-2.tied 48.9 53.0 46.1 45.4 CADec 58.1 63.2 52.0 56.7 ellipsis (infl.) ellipsis (VP) baseline 53.0 28.4 concat 76.2 76.6 s-hier-to-2.tied 66.4 65.6 CADec 72.2 80.0 The proposed test sets let us distinguish models 

 Table 8 : 8 Accuracy on ellipsis test set. 

 Table 9 : 9 Results for different probabilities of using corrupted reference at training time. BLEU for 3 context sentences. For ellipsis, we show inflection/VP scores. p BLEU deixis lex. c. ellipsis p = 0 32.34 84.1 48.7 65 / 75 p = 0.25 32.31 83.3 52.4 67 / 78 p = 0.5 32.38 81.6 58.1 72 / 80 p = 0.75 32.45 80.0 65.0 70 / 80 

			 We use the term 'inconsistency' to refer to any violations causing good translations of isolated sentences not to work together, independently of which linguistic phenomena (e.g., ellipsis or lexical cohesion) impose the violated constraints. 

			 Exceptions include (Yamamoto and Sumita, 1998) , and work on the related phenomenon of pronoun dropping (Russo et al., 2012; Wang et al., 2016; Rios and Tuggener, 2017) . 

			 Details are provided in the appendix. 

			 We use bootstrap resampling (Koehn, 2004)  for significance testing. 

			 https://github.com/kmike/pymorphy2 

			 https://github.com/moses-smt/ mosesdecoder/tree/master/scripts/generic 9 This can be reached by using several of GPUs or by accumulating the gradients for several batches and then making an update.
